# Pipeline for PlataformaReact
# Build a general Node.js project with npm.

steps:
  - powershell: |
      "Branch = '$env:BRANCH'"
    env:
      BRANCH: ${{ variables['Build.SourceBranchName'] }}
    displayName: "Show Branch is Run"

  - bash: |
      set -x
      if [ -n "$(System.PullRequest.TargetBranch)" ]; then
          git checkout $(System.PullRequest.TargetBranch)
      fi
    displayName: "Checkout pull request HEAD"

  - task: NodeTool@0
    inputs:
      versionSpec: "16.x"
    displayName: "Install Node.js"

  - script: |
      yarn install
      yarn ${{parameters.COMMAND}}
      sudo apt-get install python3.8
      curl -O https://bootstrap.pypa.io/get-pip.py
      sudo python3 get-pip.py
      sudo pip install awscli
    displayName: 'yarn install and build'

  - script: |
      aws s3 sync ./dist s3://${{parameters.BUCKET_NAME}}
      aws cloudfront create-invalidation --distribution-id ${{parameters.CLOUDFRONT_ID}} --paths "/*"
    displayName: "Running post update"
